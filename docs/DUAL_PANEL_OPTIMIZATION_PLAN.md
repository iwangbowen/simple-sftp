# Dual Panel WebView 功能优化计划

> 文档版本: 1.0
> 创建日期: 2024
> 状态: 规划中

## 📋 目录

- [1. 文件操作增强](#1-文件操作增强)
- [2. 导航与搜索](#2-导航与搜索)
- [3. 视觉与交互](#3-视觉与交互)
- [4. 传输与同步](#4-传输与同步)
- [5. 书签与会话](#5-书签与会话)
- [6. 权限与安全](#6-权限与安全)
- [7. 性能优化](#7-性能优化)
- [8. 右键上下文菜单](#8-右键上下文菜单)
- [优先级排序](#优先级排序)
- [实施路线图](#实施路线图)

---

## 1. 文件操作增强

### 1.1 批量操作

**当前状态**: ✅ 已支持多选功能

**优化项**:

#### 1.1.1 批量删除
- **功能描述**: 支持一次性删除多个选中的文件/文件夹
- **用户场景**: 清理临时文件、批量删除测试数据
- **技术要点**:
  - 确认对话框显示删除列表
  - 显示递归删除警告(文件夹)
  - 支持撤销操作(可选)
- **优先级**: ⭐⭐⭐
- **工作量**: 中

#### 1.1.2 批量重命名
- **功能描述**: 支持正则表达式批量重命名文件
- **用户场景**: 统一文件命名格式、添加前缀/后缀
- **技术要点**:
  - 模式输入界面(查找/替换)
  - 预览重命名结果
  - 支持常用模式(序号、日期等)
- **优先级**: ⭐⭐
- **工作量**: 大

#### 1.1.3 跨 Panel 复制/移动
- **功能描述**: 使用 Ctrl+C/X/V 在本地和远程之间复制/移动文件
- **用户场景**: 快速文件迁移、备份
- **技术要点**:
  - 剪贴板状态管理
  - 跨 panel 传输队列
  - 冲突处理(覆盖/跳过/重命名)
- **优先级**: ⭐⭐⭐⭐
- **工作量**: 中

---

### 1.2 文件编辑

#### 1.2.1 双击打开文件
- **功能描述**: 双击文件时在 VS Code 编辑器中打开(远程文件自动下载)
- **用户场景**: 快速编辑配置文件、查看日志
- **技术要点**:
  - 远程文件下载到临时目录
  - 文件关联处理
  - 自动清理临时文件
- **优先级**: ⭐⭐⭐⭐⭐
- **工作量**: 中

#### 1.2.2 文本文件预览
- **功能描述**: 右键菜单提供快速预览(不完全下载)
- **用户场景**: 查看远程日志、配置文件内容
- **技术要点**:
  - 仅读取文件前 N KB
  - 语法高亮显示
  - 预览窗口集成
- **优先级**: ⭐⭐
- **工作量**: 大

#### 1.2.3 远程文件自动同步
- **功能描述**: 编辑远程文件后保存时自动上传
- **用户场景**: 远程开发工作流
- **技术要点**:
  - 文件监听器
  - 变更检测
  - 冲突解决策略
- **优先级**: ⭐⭐⭐⭐
- **工作量**: 大

---

### 1.3 文件比较

#### 1.3.1 Diff 比较
- **功能描述**: 选中本地和远程同名文件后支持 diff 比较
- **用户场景**: 代码版本比较、配置差异检查
- **技术要点**:
  - 调用 VS Code diff 编辑器
  - 临时文件管理
  - 三向合并(可选)
- **优先级**: ⭐⭐⭐⭐⭐
- **工作量**: 中

#### 1.3.2 差异高亮
- **功能描述**: 在文件树中高亮显示时间戳/大小不一致的文件
- **用户场景**: 快速识别未同步文件
- **技术要点**:
  - 文件元数据比较
  - 视觉标记(颜色/图标)
  - 过滤显示差异文件
- **优先级**: ⭐⭐⭐⭐
- **工作量**: 小

---

## 2. 导航与搜索

### 2.1 路径导航

**当前状态**: ✅ 已有路径显示和刷新

**优化项**:

#### 2.1.1 路径面包屑
- **功能描述**: 将路径显示改为可点击的面包屑导航
- **用户场景**: 快速跳转到上级/祖先目录
- **示例**: `root / var / www / html` (每一段可点击)
- **技术要点**:
  - 路径分段解析
  - 点击事件处理
  - 样式与 VS Code 一致
- **优先级**: ⭐⭐⭐⭐⭐
- **工作量**: 小

#### 2.1.2 前进/后退导航
- **功能描述**: 浏览历史记录,支持前进/后退
- **用户场景**: 在多个目录间快速切换
- **技术要点**:
  - 路径历史栈
  - 快捷键绑定(Alt+Left/Right)
  - 视觉状态(禁用/启用)
- **优先级**: ⭐⭐⭐
- **工作量**: 中

#### 2.1.3 书签快速跳转
- **功能描述**: 增强现有书签功能,支持快捷键跳转
- **用户场景**: 常用目录快速访问
- **技术要点**:
  - 快捷键映射(Ctrl+1~9)
  - 书签图标显示
  - 书签管理界面
- **优先级**: ⭐⭐
- **工作量**: 小

---

### 2.2 搜索功能

**当前状态**: ✅ 已有基础过滤

**优化项**:

#### 2.2.1 正则表达式搜索
- **功能描述**: 搜索框支持正则表达式模式
- **用户场景**: 复杂文件名匹配、模式过滤
- **技术要点**:
  - 正则模式切换开关
  - 语法错误提示
  - 性能优化
- **优先级**: ⭐⭐⭐
- **工作量**: 小

#### 2.2.2 递归搜索
- **功能描述**: 深度搜索子目录中的文件
- **用户场景**: 在大型项目中查找文件
- **技术要点**:
  - 异步递归遍历
  - 搜索结果树状显示
  - 搜索取消功能
- **优先级**: ⭐⭐⭐⭐
- **工作量**: 大

#### 2.2.3 高级过滤
- **功能描述**: 按文件大小、修改时间、文件类型过滤
- **用户场景**: 查找大文件、最近修改文件
- **技术要点**:
  - 过滤条件界面
  - 多条件组合
  - 过滤器保存
- **优先级**: ⭐⭐
- **工作量**: 中

---

## 3. 视觉与交互

### 3.1 文件展示

#### 3.1.1 文件类型图标
- **功能描述**: 根据文件扩展名显示对应图标
- **用户场景**: 快速识别文件类型
- **技术要点**:
  - VS Code 图标主题集成
  - 自定义图标映射
  - Fallback 图标
- **优先级**: ⭐⭐⭐⭐⭐
- **工作量**: 中

#### 3.1.2 可读性格式化
- **功能描述**: 文件大小、时间戳人性化显示
- **示例**:
  - `2.5 MB` 而非 `2621440`
  - `2 days ago` 而非 `2024-01-15 10:30:00`
- **技术要点**:
  - 数值格式化函数
  - 相对时间计算
  - 本地化支持
- **优先级**: ⭐⭐⭐⭐
- **工作量**: 小

#### 3.1.3 视图模式切换
- **功能描述**: 支持树形视图和表格视图切换
- **用户场景**: 不同使用偏好、排序需求
- **技术要点**:
  - 双视图实现
  - 状态持久化
  - 列排序功能
- **优先级**: ⭐⭐
- **工作量**: 大

#### 3.1.4 隐藏文件开关
- **功能描述**: 显示/隐藏以 `.` 开头的文件
- **用户场景**: 减少视觉干扰、查看系统文件
- **技术要点**:
  - 过滤规则配置
  - 切换按钮
  - 配置持久化
- **优先级**: ⭐⭐⭐
- **工作量**: 小

---

### 3.2 拖拽增强

**当前状态**: ✅ 已有拖拽上传/下载

**优化项**:

#### 3.2.1 拖拽预览
- **功能描述**: 拖拽时高亮目标文件夹,显示放置位置
- **用户场景**: 防止误操作、视觉反馈
- **技术要点**:
  - Drop zone 高亮
  - 拖拽有效性检查
  - 视觉引导线
- **优先级**: ⭐⭐⭐
- **工作量**: 小

#### 3.2.2 拖拽信息提示
- **功能描述**: 显示拖拽文件数量、预计传输大小
- **用户场景**: 传输前确认
- **技术要点**:
  - 文件大小计算
  - Tooltip 显示
  - 性能优化(大文件夹)
- **优先级**: ⭐⭐
- **工作量**: 小

---

### 3.3 多选增强

**当前状态**: ⚠️ 仅支持 Ctrl+Click 单个选择

**优化项**:

#### 3.3.1 Shift 范围选择
- **功能描述**: Shift+Click 选择连续范围
- **用户场景**: 批量选择文件
- **技术要点**:
  - 范围计算算法
  - 视觉选中状态
  - 跨目录选择处理
- **优先级**: ⭐⭐⭐⭐⭐
- **工作量**: 小

#### 3.3.2 Ctrl+A 全选
- **功能描述**: 全选当前目录所有文件
- **用户场景**: 快速批量操作
- **技术要点**:
  - 焦点 panel 判断
  - 排除文件夹(可选)
  - 取消全选
- **优先级**: ⭐⭐⭐⭐
- **工作量**: 小

#### 3.3.3 选择统计
- **功能描述**: 在 footer 显示已选文件数量和总大小
- **用户场景**: 传输前确认
- **技术要点**:
  - 实时统计计算
  - 格式化显示
  - 性能优化
- **优先级**: ⭐⭐⭐
- **工作量**: 小

---

## 4. 传输与同步

### 4.1 同步功能

#### 4.1.1 文件夹同步
- **功能描述**: 单向/双向同步整个文件夹
- **用户场景**: 项目部署、备份
- **技术要点**:
  - 文件树比较算法
  - 增量传输
  - 冲突解决策略
- **优先级**: ⭐⭐⭐⭐
- **工作量**: 大

#### 4.1.2 增量同步
- **功能描述**: 只传输修改过的文件
- **用户场景**: 减少传输时间、节省带宽
- **技术要点**:
  - 文件哈希比较
  - 时间戳检查
  - 排除规则配置
- **优先级**: ⭐⭐⭐⭐
- **工作量**: 大

#### 4.1.3 同步任务保存
- **功能描述**: 保存常用同步配置,一键执行
- **用户场景**: 重复性同步任务
- **技术要点**:
  - 任务配置序列化
  - 模板管理
  - 定时同步(可选)
- **优先级**: ⭐⭐
- **工作量**: 中

---

### 4.2 传输管理

**当前状态**: ✅ 已有传输队列服务

**优化项**:

#### 4.2.1 进度条直接显示
- **功能描述**: 在 webview footer 直接显示当前传输进度
- **用户场景**: 实时反馈、无需切换视图
- **技术要点**:
  - 进度事件订阅
  - 进度条渲染
  - 多任务状态显示
- **优先级**: ⭐⭐⭐⭐⭐
- **工作量**: 小

#### 4.2.2 传输速度显示
- **功能描述**: 显示实时传输速度(KB/s, MB/s)
- **用户场景**: 网络性能监控
- **技术要点**:
  - 速率计算
  - 平均速度平滑
  - 剩余时间估算
- **优先级**: ⭐⭐⭐
- **工作量**: 小

#### 4.2.3 暂停/恢复传输
- **功能描述**: 支持暂停和恢复正在进行的传输
- **用户场景**: 网络波动、临时中断
- **技术要点**:
  - 传输状态管理
  - 断点续传
  - 队列优先级
- **优先级**: ⭐⭐⭐
- **工作量**: 大

#### 4.2.4 自动重试
- **功能描述**: 传输失败时自动重试(可配置次数)
- **用户场景**: 网络不稳定环境
- **技术要点**:
  - 错误检测
  - 重试策略(指数退避)
  - 失败通知
- **优先级**: ⭐⭐⭐⭐
- **工作量**: 中

---

## 5. 书签与会话

### 5.1 书签增强

**当前状态**: ✅ 已有路径书签功能

**优化项**:

#### 5.1.1 书签分组
- **功能描述**: 支持书签分组管理(项目/环境)
- **用户场景**: 多项目、多环境管理
- **技术要点**:
  - 分组数据结构
  - 折叠/展开界面
  - 拖拽排序
- **优先级**: ⭐⭐
- **工作量**: 中

#### 5.1.2 成对书签
- **功能描述**: 本地路径和远程路径配对书签
- **用户场景**: 快速同步对应目录
- **技术要点**:
  - 路径对数据结构
  - 双向跳转
  - 同步快捷方式
- **优先级**: ⭐⭐⭐
- **工作量**: 中

#### 5.1.3 快捷键跳转
- **功能描述**: Ctrl+1~9 直接跳转到对应书签
- **用户场景**: 快速访问常用目录
- **技术要点**:
  - 快捷键绑定
  - 书签编号显示
  - 冲突处理
- **优先级**: ⭐⭐
- **工作量**: 小

---

### 5.2 会话管理

#### 5.2.1 会话保存
- **功能描述**: 保存当前状态(主机、路径、窗口布局)
- **用户场景**: 工作环境快速恢复
- **技术要点**:
  - 状态序列化
  - 会话命名
  - 会话列表管理
- **优先级**: ⭐⭐
- **工作量**: 中

#### 5.2.2 自动恢复
- **功能描述**: 启动时恢复上次会话
- **用户场景**: 无缝工作流
- **技术要点**:
  - 会话持久化
  - 配置选项
  - 恢复失败处理
- **优先级**: ⭐⭐
- **工作量**: 小

#### 5.2.3 多会话支持
- **功能描述**: 同时连接多个主机,标签切换
- **用户场景**: 跨服务器操作
- **技术要点**:
  - 连接池管理
  - 标签页界面
  - 资源隔离
- **优先级**: ⭐
- **工作量**: 大

---

## 6. 权限与安全

#### 6.1 权限显示
- **功能描述**: 显示 Linux 文件权限(chmod)
- **用户场景**: 服务器文件管理
- **技术要点**:
  - SFTP 文件属性读取
  - 权限字符串解析(`rwxr-xr-x`)
  - 视觉化显示
- **优先级**: ⭐⭐⭐
- **工作量**: 小

#### 6.2 权限修改
- **功能描述**: 右键菜单修改文件权限
- **用户场景**: 脚本文件加执行权限
- **技术要点**:
  - 权限编辑对话框
  - SFTP chmod 操作
  - 递归修改(文件夹)
- **优先级**: ⭐⭐⭐
- **工作量**: 中

#### 6.3 所有者/组显示
- **功能描述**: 显示文件所有者和用户组
- **用户场景**: 多用户服务器管理
- **技术要点**:
  - SFTP 属性扩展
  - UID/GID 映射
  - 格式化显示
- **优先级**: ⭐⭐
- **工作量**: 小

#### 6.4 符号链接支持
- **功能描述**: 识别并显示符号链接,支持跳转
- **用户场景**: 链接导航、配置管理
- **技术要点**:
  - 链接类型检测
  - 目标路径解析
  - 视觉标记(箭头图标)
- **优先级**: ⭐⭐
- **工作量**: 中

---

## 7. 性能优化

#### 7.1 虚拟滚动
- **功能描述**: 大目录(1000+ 文件)仅渲染可见项
- **用户场景**: node_modules、日志目录
- **技术要点**:
  - 虚拟列表算法
  - 滚动事件优化
  - 高度计算
- **优先级**: ⭐⭐
- **工作量**: 大

#### 7.2 延迟加载
- **功能描述**: 子目录展开时才加载内容
- **用户场景**: 深层目录结构
- **技术要点**:
  - 惰性加载策略
  - 加载状态显示
  - 缓存管理
- **优先级**: ⭐⭐⭐
- **工作量**: 中

#### 7.3 目录缓存
- **功能描述**: 缓存已加载的目录列表
- **用户场景**: 减少网络请求
- **技术要点**:
  - LRU 缓存实现
  - 失效策略
  - 手动刷新
- **优先级**: ⭐⭐⭐
- **工作量**: 中

---

## 8. 右键上下文菜单

**当前状态**: ⚠️ 功能有限

**新增菜单项**:

| 菜单项 | 功能 | 优先级 | 工作量 |
|--------|------|--------|--------|
| 📋 复制路径 | 复制文件完整路径到剪贴板 | ⭐⭐⭐⭐ | 小 |
| 📋 复制文件名 | 仅复制文件名 | ⭐⭐⭐ | 小 |
| 🔗 在终端打开 | 打开文件所在目录的终端 | ⭐⭐⭐⭐ | 中 |
| 📊 属性 | 显示详细文件信息面板 | ⭐⭐⭐ | 中 |
| 🔍 在资源管理器显示 | 本地文件在系统文件管理器中定位 | ⭐⭐⭐ | 小 |
| 📝 创建符号链接 | 创建软链接到其他位置 | ⭐⭐ | 中 |
| 🔄 比较文件 | 对比本地和远程同名文件 | ⭐⭐⭐⭐⭐ | 中 |
| 🗜️ 压缩/解压 | 支持 zip/tar.gz 操作 | ⭐⭐ | 大 |

---

## 优先级排序

### 🔥 高优先级(P0) - 用户体验提升大

1. **路径面包屑导航** (2.1.1)
   - 影响: 极大提升导航效率
   - 工作量: 小
   - ROI: ⭐⭐⭐⭐⭐

2. **文件类型图标** (3.1.1)
   - 影响: 视觉识别更快
   - 工作量: 中
   - ROI: ⭐⭐⭐⭐⭐

3. **Diff 比较** (1.3.1)
   - 影响: 常见需求,工作流核心
   - 工作量: 中
   - ROI: ⭐⭐⭐⭐⭐

4. **传输进度实时显示** (4.2.1)
   - 影响: 反馈更直观
   - 工作量: 小
   - ROI: ⭐⭐⭐⭐⭐

5. **Shift 范围选择** (3.3.1)
   - 影响: 标准交互模式
   - 工作量: 小
   - ROI: ⭐⭐⭐⭐⭐

6. **双击打开文件** (1.2.1)
   - 影响: 编辑工作流集成
   - 工作量: 中
   - ROI: ⭐⭐⭐⭐⭐

---

### ⚡ 中优先级(P1) - 功能增强

7. **可读性格式化** (3.1.2)
   - 影响: 信息呈现优化
   - 工作量: 小
   - ROI: ⭐⭐⭐⭐

8. **差异高亮** (1.3.2)
   - 影响: 快速识别变更
   - 工作量: 小
   - ROI: ⭐⭐⭐⭐

9. **跨 Panel 复制/移动** (1.1.3)
   - 影响: 操作效率提升
   - 工作量: 中
   - ROI: ⭐⭐⭐⭐

10. **文件夹同步** (4.1.1)
    - 影响: 高级用户核心需求
    - 工作量: 大
    - ROI: ⭐⭐⭐⭐

11. **递归搜索** (2.2.2)
    - 影响: 大项目必需
    - 工作量: 大
    - ROI: ⭐⭐⭐⭐

12. **Ctrl+A 全选** (3.3.2)
    - 影响: 标准操作
    - 工作量: 小
    - ROI: ⭐⭐⭐⭐

13. **传输自动重试** (4.2.4)
    - 影响: 稳定性提升
    - 工作量: 中
    - ROI: ⭐⭐⭐⭐

14. **远程文件自动同步** (1.2.3)
    - 影响: 远程开发体验
    - 工作量: 大
    - ROI: ⭐⭐⭐⭐

---

### 💡 低优先级(P2) - 锦上添花

15. **增量同步** (4.1.2)
16. **前进/后退导航** (2.1.2)
17. **权限显示与修改** (6.1, 6.2)
18. **隐藏文件开关** (3.1.4)
19. **正则表达式搜索** (2.2.1)
20. **选择统计** (3.3.3)
21. **传输速度显示** (4.2.2)
22. **延迟加载** (7.2)
23. **目录缓存** (7.3)
24. **拖拽预览** (3.2.1)

---

### 🌟 可选优先级(P3) - 高级特性

25. **虚拟滚动** (7.1)
26. **暂停/恢复传输** (4.2.3)
27. **视图模式切换** (3.1.3)
28. **批量重命名** (1.1.2)
29. **文本文件预览** (1.2.2)
30. **高级过滤** (2.2.3)
31. **书签分组** (5.1.1)
32. **成对书签** (5.1.2)
33. **会话管理** (5.2.1-5.2.3)
34. **权限修改** (6.2)
35. **符号链接支持** (6.4)

---

## 实施路线图

### 🎯 第一阶段(Sprint 1-2) - 核心体验提升

**目标**: 打造流畅的基础交互体验

| 功能 | 工作量 | 预计时间 |
|------|--------|----------|
| 路径面包屑导航 | 小 | 1 天 |
| 文件类型图标 | 中 | 2 天 |
| Shift 范围选择 | 小 | 1 天 |
| Ctrl+A 全选 | 小 | 0.5 天 |
| 传输进度显示 | 小 | 1 天 |
| 可读性格式化 | 小 | 1 天 |

**总计**: 6.5 天

---

### 🚀 第二阶段(Sprint 3-4) - 文件操作增强

**目标**: 完善文件编辑和比较功能

| 功能 | 工作量 | 预计时间 |
|------|--------|----------|
| Diff 比较 | 中 | 2 天 |
| 双击打开文件 | 中 | 2 天 |
| 差异高亮 | 小 | 1 天 |
| 跨 Panel 复制/移动 | 中 | 3 天 |
| 右键菜单增强 | 中 | 2 天 |

**总计**: 10 天

---

### 🔄 第三阶段(Sprint 5-6) - 同步与传输

**目标**: 实现高级同步和传输管理

| 功能 | 工作量 | 预计时间 |
|------|--------|----------|
| 文件夹同步 | 大 | 5 天 |
| 增量同步 | 大 | 4 天 |
| 传输自动重试 | 中 | 2 天 |
| 远程文件自动同步 | 大 | 4 天 |

**总计**: 15 天

---

### 🔍 第四阶段(Sprint 7-8) - 搜索与导航

**目标**: 强化搜索和目录导航能力

| 功能 | 工作量 | 预计时间 |
|------|--------|----------|
| 递归搜索 | 大 | 4 天 |
| 正则表达式搜索 | 小 | 1 天 |
| 前进/后退导航 | 中 | 2 天 |
| 目录缓存 | 中 | 2 天 |

**总计**: 9 天

---

### ⚙️ 第五阶段(Sprint 9+) - 性能与高级特性

**目标**: 性能优化和高级功能

| 功能 | 工作量 | 预计时间 |
|------|--------|----------|
| 虚拟滚动 | 大 | 5 天 |
| 延迟加载 | 中 | 2 天 |
| 权限管理 | 中 | 3 天 |
| 会话管理 | 中 | 3 天 |
| 视图模式切换 | 大 | 4 天 |

**总计**: 17 天

---

## 技术债务与风险

### ⚠️ 潜在风险

1. **性能风险**
   - 大文件夹渲染可能卡顿
   - 缓解: 虚拟滚动、分页加载

2. **并发问题**
   - 多任务传输资源竞争
   - 缓解: 连接池限制、队列管理

3. **兼容性**
   - 不同 SFTP 服务器行为差异
   - 缓解: 充分测试、降级策略

### 🔧 技术债务

1. **代码结构**
   - 当前 `dual-panel-browser.js` 较大(1000+ 行)
   - 建议: 模块化重构

2. **测试覆盖**
   - 缺少前端单元测试
   - 建议: 引入 Jest/Vitest

3. **错误处理**
   - 部分操作缺少失败回滚
   - 建议: 统一错误处理机制

---

## 用户反馈机制

### 收集渠道
- GitHub Issues
- VS Code Marketplace 评论
- 使用遥测(可选,需用户同意)

### 优先级调整
根据用户投票和反馈频率动态调整路线图

---

## 附录: 参考设计

### 类似工具
- WinSCP (Windows)
- FileZilla (跨平台)
- Cyberduck (Mac)
- VS Code Remote - SSH

### 设计原则
1. 与 VS Code 原生体验一致
2. 键盘优先,鼠标辅助
3. 渐进式增强,不破坏现有功能
4. 性能优先,避免阻塞操作

---

**文档维护者**: GitHub Copilot
**最后更新**: 2024
**版本**: 1.0
